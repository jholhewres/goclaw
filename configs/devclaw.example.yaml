# ─────────────────────────────────────────────────────────────
# DevClaw - Configuration
# Copy to config.yaml and adjust as needed:
#   cp configs/devclaw.example.yaml config.yaml
# ─────────────────────────────────────────────────────────────

# ── Assistant ──────────────────────────────────────────────
name: "DevClaw"
trigger: "@devclaw"                    # Keyword that activates the bot
model: "gpt-5-mini"                    # LLM model (see options below)
timezone: "America/Sao_Paulo"
language: "pt-BR"
instructions: |
  You are a helpful personal assistant.
  Be concise and practical in your responses.
  Respond in Portuguese when the user writes in Portuguese.

# ── API Provider ──────────────────────────────────────────
# OpenAI-compatible endpoint. Supports OpenAI, Anthropic, GLM, etc.
api:
  base_url: "https://api.openai.com/v1"        # OpenAI (default)
  api_key: "${DEVCLAW_API_KEY}"                  # NEVER hardcode — use .env file
  provider: ""                                  # Auto-detected from URL
  #
  # Available models:
  #
  # GLM (api.z.ai):
  #   glm-4.7-flash    — fast, low cost (default)
  #   glm-4.7-flashx   — fast with extended context
  #   glm-4.7          — balanced capability
  #   glm-5            — most capable GLM
  #
  # OpenAI:
  #   gpt-5            — latest flagship
  #   gpt-5-mini       — fast and cost-effective
  #   gpt-4o           — great all-around
  #   gpt-4o-mini      — fast and cheap
  #   gpt-4.5-preview  — enhanced reasoning
  #
  # Anthropic:
  #   claude-opus-4.6  — most capable
  #   claude-opus-4.5  — previous flagship
  #   claude-sonnet-4.5 — balanced performance

# ── Access Control ─────────────────────────────────────────
# Who can use the bot. Default: deny (only authorized contacts).
access:
  default_policy: deny                 # deny | allow | ask
  owners:                              # Full control (your phone number)
    - "5511999999999"
  admins: []                           # Can manage users + workspaces
  allowed_users: []                    # Can interact with the bot
  blocked_users: []                    # Explicitly blocked
  allowed_groups: []                   # Group JIDs allowed
  blocked_groups: []                   # Group JIDs blocked
  pending_message: "Access not authorized. Contact an admin."

# ── Workspaces ─────────────────────────────────────────────
# Isolated profiles: each has its own prompt, skills, model, memory.
workspaces:
  default_workspace: "default"
  workspaces:
    - id: "default"
      name: "Default"
      description: "Default workspace for all users"
      active: true

    # Uncomment and customize:
    #
    # - id: "personal"
    #   name: "Personal"
    #   instructions: |
    #     You are my personal assistant. Help with daily tasks.
    #   model: "gpt-4o"
    #   language: "pt-BR"
    #   skills: [weather, web-search, gog]
    #   members: ["5511999999999"]
    #
    # - id: "work"
    #   name: "Work Team"
    #   instructions: |
    #     You are a technical assistant for our dev team.
    #   skills: [github, web-search, summarize]
    #   members: ["5511888888888"]
    #   groups: ["120363000000000000@g.us"]

# ── Channels ───────────────────────────────────────────────
channels:
  whatsapp:
    session_dir: "./sessions/whatsapp"
    trigger: "@devclaw"
    respond_to_groups: true
    respond_to_dms: true
    auto_read: true
    send_typing: true
    media_dir: "./data/media"
    max_media_size_mb: 16

# ── Memory ─────────────────────────────────────────────────
memory:
  type: "file"
  path: "./data/memory.db"
  max_messages: 100
  compression_strategy: "summarize"

# ── Security ───────────────────────────────────────────────
security:
  max_input_length: 4096
  rate_limit: 30
  enable_pii_detection: false
  enable_url_validation: true

# ── Token Budget ───────────────────────────────────────────
token_budget:
  total: 128000
  reserved: 4096
  system: 500
  skills: 2000
  memory: 1000
  history: 8000
  tools: 4000

# ── Plugins ────────────────────────────────────────────────
plugins:
  dir: "./plugins"

# ── Skills ─────────────────────────────────────────────────
# All relative paths are resolved from the config file's directory.
# This means ./skills will always work regardless of working directory.
skills:
  builtin: [weather, calculator, web-search, web-fetch]
  # Directories containing ClawdHub-format skills (SKILL.md files)
  clawdhub_dirs: ["./skills"]
  # Legacy: installed skill names (for backward compatibility)
  installed: [github, gog, summarize]

# ── Scheduler ──────────────────────────────────────────────
scheduler:
  enabled: true
  storage: "./data/scheduler.db"

# ── Logging ────────────────────────────────────────────────
logging:
  level: "info"                        # debug | info | warn | error
  format: "json"                       # json | text

# ── Background Routines ─────────────────────────────────────
routines:
  # Metrics Collector - collects and reports system metrics
  metrics:
    enabled: false                     # Enable metrics collection
    interval: 1m                       # Collection interval
    webhook: ""                        # Optional webhook URL for external reporting

  # Memory Indexer - incremental indexing of memory files
  memory_indexer:
    enabled: true                      # Enable background memory indexing
    interval: 5m                       # Indexing interval

# ── Native Media ───────────────────────────────────────────
# Native media handling for receiving, processing, and sending
# images, audio, and documents across all channels.
#
# IMPORTANT: Enrichment features depend on the 'media' config above:
#   - auto_enrich_images requires media.vision_enabled: true
#   - auto_enrich_audio requires media.transcription_enabled: true
#   - auto_enrich_documents works independently (uses pdftotext/unzip)
native_media:
  enabled: true                        # Enable native media features

  store:
    base_dir: "./data/media"           # Permanent storage directory
    temp_dir: "./data/media/temp"      # Temporary uploads directory
    max_file_size: 52428800            # 50MB max file size

  service:
    max_image_size: 20971520           # 20MB max image size
    max_audio_size: 26214400           # 25MB max audio size (Whisper limit)
    max_doc_size: 52428800             # 50MB max document size
    temp_ttl: "24h"                    # Temporary file lifetime
    cleanup_enabled: true              # Auto cleanup of expired files
    cleanup_interval: "1h"             # Cleanup check interval

  enrichment:
    auto_enrich_images: true           # Run vision on received images (requires media.vision_enabled)
    auto_enrich_audio: true            # Transcribe received audio (requires media.transcription_enabled)
    auto_enrich_documents: true        # Extract text from documents (requires pdftotext for PDFs)

# ── Database Hub ────────────────────────────────────────────
# The Database Hub provides unified access to multiple database backends.
# SQLite is the default (zero config). PostgreSQL/Supabase optional.
database:
  # Legacy path (backward compatible)
  path: "./data/devclaw.db"

  # Hub configuration (new multi-backend system)
  hub:
    # Backend type: sqlite (default) | postgresql | mysql
    backend: "sqlite"

    # SQLite configuration (default backend)
    sqlite:
      path: "./data/devclaw.db"
      journal_mode: "WAL"              # WAL | DELETE | TRUNCATE
      busy_timeout: 5000               # ms to wait for locks
      foreign_keys: true               # Enable foreign key constraints

    # PostgreSQL configuration (optional, for production)
    # postgresql:
    #   host: "localhost"
    #   port: 5432
    #   database: "devclaw"
    #   user: "devclaw"
    #   password: "${POSTGRES_PASSWORD}"
    #   ssl_mode: "require"             # disable | require | verify-full
    #
    #   # Connection pooling
    #   max_open_conns: 25
    #   max_idle_conns: 10
    #   conn_max_lifetime: "30m"
    #
    #   # Vector search (pgvector)
    #   vector:
    #     enabled: true
    #     dimensions: 1536              # OpenAI embedding dimensions
    #     index_type: "hnsw"            # hnsw | ivfflat

    # Supabase configuration (alternative to PostgreSQL)
    # postgresql:
    #   supabase_url: "${SUPABASE_URL}"
    #   password: "${SUPABASE_DB_PASSWORD}"
    #   vector:
    #     enabled: true

    # Memory database (can use different backend)
    memory:
      backend: "sqlite"                # or use primary backend
      path: "./data/memory.db"

